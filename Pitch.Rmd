---
title: "Data Products: AgroApp - Agriculture Solutions"
author: "Marcel M."
date: "5/21/2020"
output: 
  ioslides_presentation: 
    fig_caption: yes
    highlight: tango
    incremental: yes
---
<style>
body {
text-align: justify}
</style> 


## **Introduction**



1. *Grains* (such as wheat, maize, soybeans) are one of the most important crops as they play a major role in human diet, particularly in developing countries.

2. They also represent a staple food and the main source of income for farmers throughout the world.

3. The *AgroApp* aims to assist the monitoring of grains harvest in Brazil.

## The User Interface



The **user interface** is designed to present a dropdown list from each the user can select 3 types of grains: *corn*, *soybeans* and *wheat*. Once selected, the app render an **interactive map** that displays the progress of the harvesting for such crop, indicating the state where it is produced as well as the volume harvested to the current date, by hoving over the circles.

## The Server Function

In order to respond to the user selection, the server.R function was built in an reactive environment through the function observe({}).
```{r, eval=FALSE}
shinyServer(function(input, output) {
     observe({   
        output$mapCrop <- renderLeaflet({  
        agroSub <-subset(agroApp, agroApp$Grains == input$grains)
        agroSub %>%
            leaflet() %>%
            addTiles() %>%
            addCircles(weight = 2, radius = sqrt(as.numeric(agroSub$Production))*90,
            lat=agroSub$lat, lng = agroSub$lng, color = agroSub$Color,
             popup = paste(input$grains, "Production (tons):", comma(agroSub$Production, digits = 0))) %>% 
addLegend(labels = c("Corn", "Soybeans", "Wheat"),
colors = c("darkgreen", "darkorchid", "darkorange"))
        }) })})
```

## **AgroApp**
### *Example*

This is an example of output generated by the Shiny App code, avaiable at https://github.com/mmzztt/agroapp
```{r, echo=FALSE,warning=FALSE,message=FALSE, eval=TRUE}
library(shiny)
library(leaflet)
library(formattable)
library(tidyr)
grains <- read.csv("grains.csv") # dataset grain production (corn, soybeans, wheat)
cane <- read.csv("Sugarcane_production.csv") # alternative dataset to import info

# Data processing
grains <- as.data.frame(grains) # creates a data frame with variables of interesse
grains <- grains[, c(1,4,5,6)]  # for grains.
names(grains) <- c("Code", "Corn", "Soybeans", "Wheat")

cane <- as.data.frame(cane)
cane <- cane[, -(2)]

crops <- merge(cane, grains, by = "Code") # creates new data frame with all
# information of the two sets

longCrops <- crops[,c(7:9)] # transform the dataset from short to long form
gatherCrops <- longCrops %>% gather("Grains", "Production")

# Creates a new column to assign colors according grain type 
gatherCrops$Color <- ifelse(gatherCrops$Grains == "Corn", "darkgreen",
                            ifelse(gatherCrops$Grains == "Soybeans", "darkorchid",
                                   "darkorange"))

# Add new colums from the crop dataset
gatherCrops$Code <- crops[,1]
gatherCrops$State <- crops[,2]
gatherCrops$lat <- crops[,3]
gatherCrops$lng <- crops[,4]

agroApp <- gatherCrops
agroAppS <- agroApp[28:54,]        
        agroAppS%>%
            leaflet() %>%
            addTiles() %>%
            addCircles(weight = 2, radius = sqrt(as.numeric(agroAppS$Production))*90,
                       lat=agroAppS$lat, lng = agroAppS$lng, color = agroAppS$Color,
                       popup = paste(agroAppS$Grains, "Production (tons):",
                                     comma(agroAppS$Production, digits = 0))) %>% 
            addLegend(labels = c("Corn", "Soybeans", "Wheat"),
                      colors = c("darkgreen", "darkorchid", "darkorange"))
```

